# https://artifacthub.io/packages/helm/gitlab/gitlab
---
global:
  shell:
    port: 22
  ingress:
    # https://docs.gitlab.com/charts/charts/globals#configure-ingress-settings
    # https://docs.gitlab.com/charts/charts/globals#globalingressconfigurecertmanager
    # tls:
    #   enabled: true
    #   secretName: gitlab-tls-certificate
    configureCertmanager: false
nginx-ingress:
  controller:
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 1
certmanager:
  install: false
prometheus:
  install: false
# https://gitlab.com/gitlab-org/charts/gitlab-runner/-/blob/main/values.yaml
gitlab-runner:
  install: false
  # https://docs.gitlab.com/charts/installation/tls.html#option-4-use-auto-generated-self-signed-wildcard-certificate
  # The RELEASE-wildcard-tls-chain contains both the CA certificate and the wildcard certificate which you can also use directly for GitLab Runner via gitlab-runner.certsSecretName=RELEASE-wildcard-tls-chain
  # https://docs.gitlab.com/runner/configuration/tls-self-signed.html#supported-options-for-self-signed-certificates
  certsSecretName: gitlab-wildcard-tls-chain #gitlab-tls-certificate # gitlab-wildcard-tls-chain
  logLevel: debug
  runners:
    locked: false
    config: |
      [[runners]]
        [runners.kubernetes]
          image = "docker:20.10.8"
          poll_timeout = 180
          privileged = true
        [runners.kubernetes.volumes]
          [[runners.kubernetes.volumes.empty_dir]]
            name = "docker-certs"
            mount_path = "/certs/client"
            medium = "Memory"
          [[runners.kubernetes.volumes.pvc]]
            name = "gitlab-dind-var-lib"
            mount_path = "/var/lib/docker"
    executor: kubernetes
redis:
  master:
    persistence:
      size: 1Gi
postgresql:
  persistence:
    size: 1Gi
gitlab:
  webservice:
    ingress:
      tls:
        secretName: gitlab-tls-certificate
    hpa:
      minReplicas: 1
      maxReplicas: 1
  sidekiq:
    minReplicas: 1
    maxReplicas: 1
  gitaly:
    persistence:
      size: 1Gi
  gitlab-shell:
    minReplicas: 1
    maxReplicas: 1
minio:
  ingress:
    tls:
      secretName: gitlab-tls-certificate
  persistence:
    size: 1Gi
registry:
  ingress:
    tls:
      secretName: gitlab-tls-certificate
  hpa:
    minReplicas: 1
    maxReplicas: 1
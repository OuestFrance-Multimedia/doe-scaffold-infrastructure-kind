# https://artifacthub.io/packages/helm/gitlab/gitlab
---
global:
  shell:
    port: 22
  ingress:
    # https://docs.gitlab.com/charts/charts/globals#configure-ingress-settings
    # https://docs.gitlab.com/charts/charts/globals#globalingressconfigurecertmanager
    tls:
      enabled: true
      secretName: gitlab-tls-certificate
    configureCertmanager: false
nginx-ingress:
  controller:
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 1
certmanager:
  install: false
prometheus:
  install: false
# https://gitlab.com/gitlab-org/charts/gitlab-runner/-/blob/main/values.yaml
gitlab-runner:
  certsSecretName: gitlab-tls-certificate # gitlab-wildcard-tls-chain
  envVars:
    # we cannot customize names for the secret keys, indeed secret is generated by cert-manager
    # gitlab runner search host key
    # so, we can change CI_SERVER_TLS_CA_FILE env var
    - name: CI_SERVER_TLS_CA_FILE
      value: /home/gitlab-runner/.gitlab-runner/certs/tls.crt
  logLevel: debug
  runners:
    locked: false
    config: |
      [[runners]]
        [runners.kubernetes]
          image = "docker:20.10.8"
          poll_timeout = 180
          privileged = true
        [runners.kubernetes.volumes]
          [[runners.kubernetes.volumes.empty_dir]]
            name = "docker-certs"
            mount_path = "/certs/client"
            medium = "Memory"
          [[runners.kubernetes.volumes.pvc]]
            name = "gitlab-dind-var-lib"
            mount_path = "/var/lib/docker"
    executor: kubernetes
redis:
  master:
    persistence:
      size: 1Gi
postgresql:
  persistence:
    size: 1Gi
gitlab:
  webservice:
    hpa:
      minReplicas: 1
      maxReplicas: 1
  sidekiq:
    minReplicas: 1
    maxReplicas: 1
  gitaly:
    persistence:
      size: 1Gi
  gitlab-shell:
    minReplicas: 1
    maxReplicas: 1
minio:
  persistence:
    size: 1Gi
registry:
  hpa:
    minReplicas: 1
    maxReplicas: 1